<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Agenda Simples</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; }
        input, textarea, button { margin: 4px 0; width: 100%; padding: 6px; }
        textarea { height: 100px; }
        .section { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; border-radius: 6px; }
        pre { background: #f7f7f7; padding: 10px; border-radius: 6px; white-space: pre-wrap; }
    </style>
</head>
<body>
<h1>Agenda Simples</h1>

<!-- Listar eventos -->
<div class="section">
    <h2>Listar eventos</h2>
    <label>Início (ISO opcional): <input type="datetime-local" id="inicioLista"></label>
    <label>Fim (ISO opcional): <input type="datetime-local" id="fimLista"></label>
    <button onclick="listarEventos()">Listar</button>
</div>

<!-- Obter evento -->
<div class="section">
    <h2>Obter evento por ID</h2>
    <input type="number" id="idGet" placeholder="ID do evento">
    <button onclick="obterEvento()">Obter</button>
</div>

<!-- Criar evento -->
<div class="section">
    <h2>Criar evento</h2>
    <input type="text" id="nomePost" placeholder="Nome">
    <textarea id="descPost" placeholder="Descrição"></textarea>
    <input type="datetime-local" id="inicioPost">
    <input type="number" id="duracaoPost" placeholder="Duração (minutos)">
    <button onclick="criarEvento()">Criar</button>
</div>

<!-- Atualizar evento -->
<div class="section">
    <h2>Atualizar evento</h2>
    <input type="number" id="idPut" placeholder="ID do evento">
    <input type="text" id="nomePut" placeholder="Novo nome">
    <textarea id="descPut" placeholder="Nova descrição"></textarea>
    <input type="datetime-local" id="inicioPut">
    <input type="number" id="duracaoPut" placeholder="Nova duração (minutos)">
    <button onclick="atualizarEvento()">Atualizar</button>
</div>

<!-- Excluir evento -->
<div class="section">
    <h2>Excluir evento</h2>
    <input type="number" id="idDelete" placeholder="ID do evento">
    <button onclick="excluirEvento()">Excluir</button>
</div>

<!-- Sugestão -->
<div class="section">
    <h2>Sugestão de horário</h2>
    <input type="datetime-local" id="inicioSug">
    <input type="datetime-local" id="fimSug">
    <input type="number" id="duracaoSug" placeholder="Duração (minutos)">
    <button onclick="sugerirHorario()">Sugerir</button>
</div>

<h2>Resultado:</h2>
<pre id="saida"></pre>

<script>
    const baseUrl = '/agenda/eventos';

    async function listarEventos() {
        const ini = document.getElementById('inicioLista').value;
        const fim = document.getElementById('fimLista').value;
        let url = baseUrl;
        const params = [];
        if (ini) params.push(`inicio=${new Date(ini).toISOString()}`);
        if (fim) params.push(`fim=${new Date(fim).toISOString()}`);
        if (params.length) url += '?' + params.join('&');
        mostrar(await fetchJson(url));
    }

    async function obterEvento() {
        const id = document.getElementById('idGet').value;
        if (!id) return alert('Informe o ID');
        mostrar(await fetchJson(`${baseUrl}/${id}`));
    }

    async function criarEvento() {
        const nome = document.getElementById('nomePost').value;
        const desc = document.getElementById('descPost').value;
        const inicio = document.getElementById('inicioPost').value;
        const duracao = parseInt(document.getElementById('duracaoPost').value);
        const evento = { nome, descricao: desc, inicio: new Date(inicio).toISOString(), duracao };
        mostrar(await fetchJson(baseUrl, 'POST', evento));
    }

    async function atualizarEvento() {
        const id = document.getElementById('idPut').value;
        if (!id) return alert('Informe o ID');
        const evento = {
            nome: document.getElementById('nomePut').value,
            descricao: document.getElementById('descPut').value,
            inicio: new Date(document.getElementById('inicioPut').value).toISOString(),
            duracao: parseInt(document.getElementById('duracaoPut').value)
        };
        mostrar(await fetchJson(`${baseUrl}/${id}`, 'PUT', evento));
    }

    async function excluirEvento() {
        const id = document.getElementById('idDelete').value;
        if (!id) return alert('Informe o ID');
        mostrar(await fetchJson(`${baseUrl}/${id}`, 'DELETE'));
    }

    async function sugerirHorario() {
        const ini = new Date(document.getElementById('inicioSug').value).toISOString();
        const fim = new Date(document.getElementById('fimSug').value).toISOString();
        const dur = parseInt(document.getElementById('duracaoSug').value);
        const url = `${baseUrl}/sugestao?inicio=${ini}&fim=${fim}&duracao=${dur}`;
        mostrar(await fetchText(url));
    }

    async function fetchJson(url, method = 'GET', body = null) {
        const opt = { method, headers: { 'Content-Type': 'application/json' } };
        if (body) opt.body = JSON.stringify(body);
        const resp = await fetch(url, opt);
        return resp.ok ? resp.json() : { erro: resp.status, detalhe: await resp.text() };
    }

    async function fetchText(url) {
        const resp = await fetch(url);
        return resp.ok ? resp.text() : `${resp.status}: ${await resp.text()}`;
    }

    function mostrar(data) {
        document.getElementById('saida').textContent =
            typeof data === 'string' ? data : JSON.stringify(data, null, 2);
    }
</script>
</body>
</html>
